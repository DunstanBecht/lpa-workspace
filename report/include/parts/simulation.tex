\section{Simulation}

This section is related to X-ray diffraction and Fourier analysis.

\subsection{Method}

\subsubsection{The diffracted intensity profile and its Fourier transform}

Let \gls{difint} be the \glsdesc{difint} as defined by \textcite{W1979}.
\gls{difint} is a function of \gls{radcdn} the \glsdesc{radcdn} defined in \eqref{eq:S}.
\gls{wavlen} is the \glsdesc{wavlen}, \( \gls{brgang}_B \) is the Bragg angle of the average lattice defined in \eqref{eq:Bragg-angle} and \gls{celprm} is the \glsdesc{celprm}.
\gls{difint} is normalized according to \eqref{eq:norm-I}.

\begin{equation}\label{eq:Bragg-angle}
\sin \gls{brgang}_B = \frac{\gls{wavlen} \sqrt{h^2+k^2+l^2}}{2 \gls{celprm}}
\end{equation}

\begin{equation}\label{eq:S}
\gls{radcdn} = \frac{2 \left( \sin \gls{brgang} - \sin \gls{brgang}_B \right)}{\gls{wavlen}}
\end{equation}

\begin{equation}\label{eq:norm-I}
\int \gls{difint}(\gls{radcdn}) d\gls{radcdn} = 1
\end{equation}

The \glsdesc{difint} \gls{difint} can be represented in terms of its Fourier transform coefficients \gls{frrcfa} and \gls{frrcfb} for \( {\gls{hmc}} \in \gls{setN}^*_+ \) according to \eqref{eq:fourier-a} and \eqref{eq:fourier-b}.

\begin{equation}\label{eq:fourier-a}
\gls{frrcfa}(\gls{frrvar}) = \int \gls{difint}(\gls{radcdn}) \cos \left( -2 \pi \gls{hmc} \gls{radcdn} \gls{frrvar} \right) d\gls{radcdn}
\end{equation}

\begin{equation}\label{eq:fourier-b}
\gls{frrcfb}(\gls{frrvar}) = \int \gls{difint}(\gls{radcdn}) \sin \left( -2 \pi \gls{hmc} \gls{radcdn} \gls{frrvar} \right) d\gls{radcdn}
\end{equation}

Let \gls{vecu} be the \glsdesc{vecu}.
According to the kinematical theory of X-ray scattering \cite{W1990}:

\begin{equation}\label{eq:fourier-a-warren}
\gls{frrcfa}(\gls{frrvar}) = \frac{\int_{\gls{roi}} \cos \left( 2 \pi \gls{hmc} \gls{vecg} \cdot \left[ \gls{vecu}(\vec{r} + \gls{frrvar} \overrightarrow{u_x}) - \gls{vecu}(\vec{r}) \right] \right) d\vec{r}}{\gls{area}_{\gls{roi}}}
\end{equation}

\begin{equation}\label{eq:fourier-b-warren}
\gls{frrcfb}(\gls{frrvar}) = \frac{\int_{\gls{roi}} \sin \left( 2 \pi \gls{hmc} \gls{vecg} \cdot \left[ \gls{vecu}(\vec{r} + \gls{frrvar} \overrightarrow{u_x}) - \gls{vecu}(\vec{r}) \right] \right) d\vec{r}}{\gls{area}_{\gls{roi}}}
\end{equation}

\medskip

The resultant displacement field created by a dislocation located in \( ( x, y ) \) with respect to the observation position is given in equation \eqref{eq:displacement-field}.

\begin{align}\label{eq:displacement-field}
\gls{vecu} =
  \left( \begin{array}{l}
    \gls{indfun}_{\mathrm{edge}} \frac{| \gls{vecb} |}{2 \pi} \left( \arctan \left( \frac{y}{x} \right) + \frac{x y}{2 (1 - \gls{pssrat}) \left( x^2 + y^2 \right)} \right)
    \\[5mm]
    - \gls{indfun}_{\mathrm{edge}} \frac{| \gls{vecb} |}{8 \pi (1 - \gls{pssrat})} \left( (1 - 2 \gls{pssrat}) \ln \left( x^2 + y^2 \right) + \frac{x^2 - y^2}{x^2 + y^2} \right)
    \\[5mm]
    \gls{indfun}_{\mathrm{screw}} \frac{| \gls{vecb} |}{2 \pi} \arctan \left( \frac{y}{x} \right)
  \end{array} \right)
\end{align}

\subsubsection{The choice of the step}

The step for \gls{frrvar} is called \gls{frrstp} and is given in equation \eqref{eq:fourier-a3} \cite{W1990}.
There are experimental constraint upon \gls{brgang} that limit the range of available values for \gls{frrstp}.

\begin{equation}\label{eq:fourier-L-step}
\gls{frrvar} = i \gls{frrstp} \ \text{with} \ i \in \gls{setN}^*_+
\end{equation}

\begin{equation}\label{eq:fourier-a3}
\gls{frrstp} = \frac{\gls{wavlen}}{4 \left( \sin \gls{brgang} - \sin \gls{brgang}_B \right)}
\end{equation}

\medskip

Assuming \( \gls{wavlen} = 0.154 \) nm (Cu) and \( \gls{celprm} =  0.4046 \) nm  (for Al FCC), we get the following table.

\medskip

{\renewcommand{\arraystretch}{1.6}

\input{insert/a3/a3}

\captionof{table}{Range for \( a_3 \) depending on (hkl).}

Here \( a_3 \) will be set to \( 1.6 \) nm.

\subsubsection{Parallelization}

To calculate \( \gls{frrcfa}(\gls{frrvar}) \) and \( \gls{frrcfb}(\gls{frrvar}) \), the Monte Carlo method is used.
A large number of random points \( \vec{r} \) are drawn in the crystal and the equations \eqref{eq:fourier-a-warren} and \eqref{eq:fourier-b-warren} are applied. The random draws and the calculations are then parallelized since they are independent.

\subsection{Program}

The second program allows the simulation of X-ray diffraction and Fourier analysis.
It was implemented with OpenCL in order to take advantage of the high capacity of parallelization of the calculations on a graphics card.

\subsubsection{Repository}

Useful information can be found on the project page: \github{lpa-xrd}

\subsubsection{Installation}

The program can be installed or updated with the following command:

\pipinstall{lpa-xrd}

\subsubsection{Output data}

For each simulation a file containing the coefficients \( \gls{frrcfa}(\gls{frrvar}) \) and \( \gls{frrcfb}(\gls{frrvar}) \) for each harmonic \gls{hmc} and Fourier variable \gls{frrvar} is produced.
The structure of these files is illustrated by the example file below.

\pyscript{insert/output}{output\_data.py}

\txtlst{insert/output}{output\_data.dat}
